package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.34

import (
	"context"
	"virtuozplay/graph/model"
	db "virtuozplay/models"

	"github.com/vektah/gqlparser/v2/gqlerror"
)

// StartPerformance is the resolver for the startPerformance field.
func (r *mutationResolver) StartPerformance(ctx context.Context) (*model.Performance, error) {
	_ = ctx
	return ToGraphQLPerformance(r.Performances.New())
}

// AddNotesToPerformance is the resolver for the addNotesToPerformance field.
func (r *mutationResolver) AddNotesToPerformance(ctx context.Context, id string, notes []*model.InputNote) (*model.Performance, error) {
	_ = ctx
	perf, err := r.Performances.FindInProgressByNanoID(db.NanoID(id))
	if err != nil {
		return nil, err
	}

	errors := make(gqlerror.List, 0)

	for i, note := range notes {
		err = perf.AppendNote(i,
			note.At,
			note.Duration,
			note.Value,
		)
		// Append the invalid notes to the errors list, but only if we haven't reached the limit (to avoid spamming the user)
		if err != nil && uint(len(errors)) < db.NoteValidationLimit {
			errors = append(errors, gqlerror.Wrap(err))
		}
	}
	// Append the notes that are not invalid
	gqlPerf, gqlErr := ToGraphQLPerformance(perf, r.Performances.Update(perf))

	if gqlErr != nil {
		return nil, gqlErr
	}
	if len(errors) > 0 {
		// Return invalid note errors, note that the valid ones are still saved
		return gqlPerf, errors
	}
	return gqlPerf, nil
}

// FinishPerformance is the resolver for the finishPerformance field.
func (r *mutationResolver) FinishPerformance(ctx context.Context, id string) (*model.Performance, error) {
	_ = ctx
	perf, err := r.Performances.FindByNanoID(db.NanoID(id))
	if err != nil {
		return nil, err
	}

	return ToGraphQLPerformance(perf, r.Performances.MarkAsFinished(perf))
}

// VirtuozPlay is the resolver for the virtuozPlay field.
func (r *queryResolver) VirtuozPlay(ctx context.Context) (*model.VirtuozPlay, error) {
	_ = ctx
	return &model.VirtuozPlay{Version: "0.1.0"}, nil
}

// Performance is the resolver for the performance field.
func (r *queryResolver) Performance(ctx context.Context, id string) (*model.Performance, error) {
	_ = ctx
	return ToGraphQLPerformance(r.Performances.FindByNanoID(db.NanoID(id)))
}

// Songs is the resolver for the songs field.
func (r *queryResolver) Songs(ctx context.Context) ([]*model.Song, error) {
	return []*model.Song{
		{
			ID:    "h8rHA-Q0dD5dBbY1L2Fzf",
			Title: "Cancan",
			Notes: []*model.SongNote{
				{Measure: 1, Note: "C", Fret: 10, String: 2, Start: 0, End: 1000},
				{Measure: 2, Note: "C", Fret: 11, String: 2, Start: 1000, End: 2000},
				{Measure: 3, Note: "C", Fret: 10, String: 2, Start: 2000, End: 3000},
				{Measure: 4, Note: "C", Fret: 11, String: 2, Start: 3000, End: 4000},
				{Measure: 5, Note: "C", Fret: 17, String: 2, Start: 4000, End: 5000},
				{Measure: 6, Note: "C", Fret: 18, String: 2, Start: 5000, End: 6000},
				{Measure: 7, Note: "C", Fret: 17, String: 2, Start: 6000, End: 7000},
				{Measure: 7, Note: "C", Fret: 18, String: 2, Start: 7000, End: 8000},
			},
		},
		{
			ID:    "",
			Title: "Cancan",
			Notes: []*model.SongNote{
				{Measure: 1, Note: "C", Fret: 10, String: 4, Octave: 4, Start: 0, End: 1000},
				{Measure: 2, Note: "D", Fret: 11, String: 4, Octave: 4, Start: 1000, End: 2000},
				{Measure: 3, Note: "E", Fret: 10, String: 3, Octave: 4, Start: 2200, End: 3000},
				{Measure: 4, Note: "C", Fret: 11, String: 2, Octave: 4, Start: 3000, End: 4000},
				{Measure: 5, Note: "D", Fret: 14, String: 1, Octave: 5, Start: 4000, End: 5000},
				{Measure: 6, Note: "E", Fret: 2, String: 5, Octave: 5, Start: 5000, End: 6000},
				{Measure: 7, Note: "C", Fret: 3, String: 4, Octave: 5, Start: 6000, End: 7000},
				{Measure: 7, Note: "A", Fret: 1, String: 2, Octave: 5, Start: 7000, End: 8000},
			},
		},
		{
			Title: "Corinna",
			Notes: []*model.SongNote{
				{Measure: 1, Note: "A", Fret: 10, String: 2, Octave: 4, Start: 0, End: 1000},
				{Measure: 2, Note: "A", Fret: 11, String: 2, Octave: 4, Start: 1000, End: 2000},
				{Measure: 3, Note: "C", Fret: 10, String: 2, Octave: 4, Start: 2000, End: 3000},
				{Measure: 4, Note: "A", Fret: 11, String: 2, Octave: 4, Start: 3000, End: 4000},
				{Measure: 5, Note: "C", Fret: 11, String: 2, Octave: 5, Start: 4000, End: 5000},
				{Measure: 6, Note: "A", Fret: 11, String: 2, Octave: 5, Start: 5000, End: 6000},
				{Measure: 7, Note: "C", Fret: 1, String: 2, Octave: 5, Start: 6000, End: 7000},
				{Measure: 7, Note: "C", Fret: 2, String: 2, Octave: 5, Start: 7000, End: 8000},
			},
		},
	}, nil
}

// Mutation returns MutationResolver implementation.
func (r *Resolver) Mutation() MutationResolver { return &mutationResolver{r} }

// Query returns QueryResolver implementation.
func (r *Resolver) Query() QueryResolver { return &queryResolver{r} }

type mutationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
